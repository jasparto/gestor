<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"                
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                template="/template.xhtml"
                >

    <ui:define name="content">
        <h:form id="form-administrar-detalle" enctype="multipart/form-data" style="font-size: small;">
            <div align="right">
                <p:commandButton icon="ui-icon-closethick" action="#{uiAdministrarAgenda.cerrarPanelDetalleAgenda}" process="@this" style="width: 50px; height: 50px;"/>
            </div>
            <h:panelGrid columns="2" rendered="#{uiAdministrarAgenda.visualizandoDetalleAgenda}">
                <h:outputText value="Ver Excluidos: " />
                <p:inputSwitch value="#{uiAdministrarAgenda.visualizandoExcluidos}">
                    <p:ajax listener="#{uiAdministrarAgenda.cargarExcluidosAgenda()}" update="pg-agenda-detalle dtAgendaDetalle dtAgendaDetalleEliminados dtAgendaDetalleExcluidos" process="@this"/>
                </p:inputSwitch>
            </h:panelGrid>

            <h:panelGroup id="pg-agenda-detalle" >

                <p:panel id="panelDetalleAgenda" header="Detalle Agenda #{uiAdministrarAgenda.agendaPacientes.agendaPacientesPK.codAgenda}" >
                    <p:dataTable id="dtAgendaDetalle" var="varAgendaDetalle" value="#{uiAdministrarAgenda.agendaPacientes.agendaPacientesDetalleCollection}" rowStyleClass="Centro" filterEvent="enter"
                                 rows="10" paginator="true" emptyMessage="Agenda sin registros." widgetVar="widgetVarAgendaDetalle">
                        <p:column headerText="Caf" filterBy="#{varAgendaDetalle.caf.nombre}"  filterMatchMode="contains" 
                                  sortBy="#{varAgendaDetalle.caf.nombre}">
                            <h:outputText value="#{varAgendaDetalle.caf.nombre}" />
                        </p:column> 
                        <p:column headerText="Prefijo" style="width: 50px;">
                            <h:outputText value="#{varAgendaDetalle.agendaPacientesDetallePK.codPrefijo}" />
                        </p:column> 
                        <p:column headerText="Formula" filterBy="#{varAgendaDetalle.agendaPacientesDetallePK.numeroFormula}"  filterMatchMode="contains"
                                  sortBy="#{varAgendaDetalle.agendaPacientesDetallePK.numeroFormula}">
                            <h:outputText value="#{varAgendaDetalle.agendaPacientesDetallePK.numeroFormula}" />
                        </p:column> 
                        <p:column headerText="Documento Paciente" filterBy="#{varAgendaDetalle.documentoBeneficiario}"  filterMatchMode="contains"
                                  sortBy="#{varAgendaDetalle.documentoBeneficiario}">
                            <h:outputText value="#{varAgendaDetalle.documentoBeneficiario}" />
                        </p:column>
                        <p:column headerText="Fecha Entrega" filterBy="#{varAgendaDetalle.fechaEntrega}"  filterMatchMode="contains"
                                  sortBy="#{varAgendaDetalle.fechaEntrega}">
                            <h:outputText value="#{varAgendaDetalle.fechaEntrega}" >
                                <f:convertDateTime pattern="dd/MM/yyyy" timeZone="America/Bogota"/>
                            </h:outputText>

                        </p:column>
                        <p:column headerText="Acciones" >
                            <p:commandButton icon="ui-icon-circle-zoomin" title="Detalle"/>
                            <p:commandButton icon="ui-icon-circle-close" title="Eliminar" action="#{uiAdministrarAgenda.eliminarDetalleAgenda()}" update="form-administrar-detalle:pg-agenda-detalle"/>

                        </p:column>
                    </p:dataTable>
                </p:panel>
                <p:separator style="height: 3px"/>
                <p:panel header="Eliminados Agenda #{uiAdministrarAgenda.agendaPacientes.agendaPacientesPK.codAgenda}"
                         toggleable="true" style="font-size: xx-small" widgetVar="varDetalleAgendaEliminados">
                    <p:ajax event="toggle" />
                    <p:dataTable id="dtAgendaDetalleEliminados" var="varAgendaDetalleEliminados" value="#{uiAdministrarAgenda.agendaPacientesEliminado.agendaPacientesDetalleCollection}" rowStyleClass="letra-xx-small-centro" filterEvent="enter"
                                 rows="10" paginator="true" emptyMessage="No se encontraron registros eliminados para esta agenda." widgetVar="widgetVarAgendaDetalleEliminados"
                                 >
                        <p:column headerText="Caf" filterBy="#{varAgendaDetalleEliminados.caf.nombre}"  filterMatchMode="contains" 
                                  sortBy="#{varAgendaDetalleEliminados.caf.nombre}"
                                  style="font-size:xx-small;">
                            <h:outputText value="#{varAgendaDetalleEliminados.caf.nombre}" />
                        </p:column>
                        <p:column headerText="Prefijo" style="width: 50px; font-size:xx-small;">
                            <h:outputText value="#{varAgendaDetalleEliminados.agendaPacientesDetallePK.codPrefijo}" />
                        </p:column> 
                        <p:column headerText="Formula" filterBy="#{varAgendaDetalleEliminados.agendaPacientesDetallePK.numeroFormula}"  filterMatchMode="contains"
                                  sortBy="#{varAgendaDetalleEliminados.agendaPacientesDetallePK.numeroFormula}"
                                  style="font-size:xx-small;">
                            <h:outputText value="#{varAgendaDetalleEliminados.agendaPacientesDetallePK.numeroFormula}" />
                        </p:column> 
                        <p:column headerText="Documento Paciente" filterBy="#{varAgendaDetalleEliminados.documentoBeneficiario}"  filterMatchMode="contains"
                                  sortBy="#{varAgendaDetalleEliminados.documentoBeneficiario}"
                                  style="font-size:xx-small;">
                            <h:outputText value="#{varAgendaDetalleEliminados.documentoBeneficiario}" />
                        </p:column>
                        <p:column headerText="Fecha Entrega" filterBy="#{varAgendaDetalleEliminados.fechaEntrega}"  filterMatchMode="contains"
                                  sortBy="#{varAgendaDetalleEliminados.fechaEntrega}"
                                  style="font-size:xx-small;">
                            <h:outputText value="#{varAgendaDetalleEliminados.fechaEntrega}" >
                                <f:convertDateTime pattern="dd/MM/yyyy" timeZone="America/Bogota"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Usuario" filterBy="#{varAgendaDetalleEliminados.usuario}"  filterMatchMode="contains"
                                  sortBy="#{varAgendaDetalleEliminados.usuario}"
                                  style="font-size:xx-small;">
                            <h:outputText value="#{varAgendaDetalleEliminados.usuario}" />
                        </p:column>
                        <p:column headerText="Acciones" style="font-size:small;">
                            <p:commandButton icon="ui-icon-circle-zoomin" title="Detalle"/>
                            <p:commandButton icon="ui-icon-arrowreturnthick-1-w" title="Deshacer" action="#{uiAdministrarAgenda.deshacerDetalleAgenda()}"  update="form-administrar-detalle:pg-agenda-detalle"/>
                        </p:column>
                    </p:dataTable>
                </p:panel>
                <p:separator style="height: 3px"/>
                <p:panel id="panelExcluidos" header="Excluidos Agenda #{uiAdministrarAgenda.agendaPacientes.agendaPacientesPK.codAgenda}"
                         rendered="#{uiAdministrarAgenda.visualizandoDetalleAgenda and uiAdministrarAgenda.visualizandoExcluidos}" 
                         toggleable="true" style="font-size: xx-small" widgetVar="varDetalleAgendaExcluidos">
                    <p:ajax event="toggle" />
                    <p:dataTable id="dtAgendaDetalleExcluidos" var="varAgendaDetalleExcluidos" value="#{uiAdministrarAgenda.ulgAgendaPacientesDetalleNoIncluidosList}" rowStyleClass="letra-xx-small-centro" filterEvent="enter"
                                 rows="10" paginator="true" emptyMessage="No se encontraron registros excluidos para esta agenda" widgetVar="widgetVarAgendaDetalleExcluidos"
                                 >
                        <p:column headerText="Caf" filterBy="#{varAgendaDetalleExcluidos.caf.nombre}"  filterMatchMode="contains" 
                                  sortBy="#{varAgendaDetalleExcluidos.caf.nombre}"
                                  style="font-size:xx-small;">
                            <h:outputText value="#{varAgendaDetalleExcluidos.caf.nombre}" />
                        </p:column>
                        <p:column headerText="Prefijo" style="width: 50px; font-size:xx-small;" >
                            <h:outputText value="#{varAgendaDetalleExcluidos.ulgAgendaPacientesDetalleNoIncluidosPK.codPrefijo}" />
                        </p:column> 
                        <p:column headerText="Formula" filterBy="#{varAgendaDetalleExcluidos.ulgAgendaPacientesDetalleNoIncluidosPK.numeroFormula}"  filterMatchMode="contains"
                                  sortBy="#{varAgendaDetalleExcluidos.ulgAgendaPacientesDetalleNoIncluidosPK.numeroFormula}"
                                  style="font-size:xx-small;">
                            <h:outputText value="#{varAgendaDetalleExcluidos.ulgAgendaPacientesDetalleNoIncluidosPK.numeroFormula}" />
                        </p:column> 
                        <p:column headerText="Documento Paciente" filterBy="#{varAgendaDetalleExcluidos.documentoBeneficiario}"  filterMatchMode="contains"
                                  sortBy="#{varAgendaDetalleExcluidos.documentoBeneficiario}"
                                  style="font-size:xx-small;">
                            <h:outputText value="#{varAgendaDetalleExcluidos.documentoBeneficiario}" />
                        </p:column>
                        <p:column headerText="Fecha Entrega" filterBy="#{varAgendaDetalleExcluidos.fechaEntrega}"  filterMatchMode="contains"
                                  sortBy="#{varAgendaDetalleExcluidos.fechaEntrega}"
                                  style="font-size:xx-small;">
                            <h:outputText value="#{varAgendaDetalleExcluidos.fechaEntrega}" >
                                <f:convertDateTime pattern="dd/MM/yyyy" timeZone="America/Bogota"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Usuario" filterBy="#{varAgendaDetalleExcluidos.usuario}"  filterMatchMode="contains"
                                  sortBy="#{varAgendaDetalleExcluidos.usuario}"
                                  style="font-size:xx-small;">
                            <h:outputText value="#{varAgendaDetalleExcluidos.usuario}" />
                        </p:column>
                        <p:column headerText="Motivo" filterBy="#{varAgendaDetalleExcluidos.motivo}"  filterMatchMode="contains"
                                  sortBy="#{varAgendaDetalleExcluidos.motivo}"
                                  style="font-size:xx-small;">
                            <h:outputText value="#{varAgendaDetalleExcluidos.motivo}" />
                        </p:column>
                        <p:column headerText="Acciones" style="font-size:small;" >
                            <p:commandButton icon="ui-icon-circle-zoomin" title="Detalle"/>
                            <p:commandButton icon=" ui-icon-circle-arrow-n" title="Incluir" action="#{uiAdministrarAgenda.incluirExcluidoAgenda()}"  process="@this"
                                             update="form-administrar-detalle:panelDetalleAgenda form-administrar-detalle:panelExcluidos"/>
                        </p:column>
                    </p:dataTable>
                </p:panel>

            </h:panelGroup>

            <h:panelGrid id="pgBarra">
                <ui:include src="/barra.xhtml">
                    <ui:param name="bean" value="#{uiAdministrarAgenda}"/>
                </ui:include>
            </h:panelGrid>

            <p:dialog id="dialog" widgetVar="dialog" header="#{sesion.dialogo.header}" showEffect="#{sesion.dialogo.effect}" hideEffect="#{sesion.dialogo.effect}"
                      onHide="limpiarModal()">
                <ui:include src="#{sesion.dialogo.src}"/>
            </p:dialog>
            <p:remoteCommand name="limpiarModal" action="#{uiSesion.limpiarDialogo()}" update="dialog" />

            <p:outputPanel>
                <p:dialog id="dialogGuardarAgenda" widgetVar="dialogGuardarAgenda" header="Guardar Agenda" showEffect="clip" hideEffect="clip"
                          closeOnEscape="true" modal="true">
                    <h:outputText value="¿ Que acción desea realizar ? - recuerde, si se Aprueba la agenda ya no se podra efectuar cambios"/>
                    <h:panelGrid columns="3" cellspacing="20">
                        <p:commandButton icon="ui-icon-check" value="Guardar" style="width: 150px;" process="@parent" action="#{uiAdministrarAgenda.guardarAgenda()}"
                                         oncomplete="PF('dialogGuardarAgenda').hide();" update="pg-agenda-detalle"/>
                        <p:commandButton icon="ui-icon-gear" value="Aprobar" style="width: 150px;" 
                                         oncomplete="PF('dialogGuardarAgenda').hide(); aprobarAgenda();"/>
                        <p:commandButton icon="ui-icon-closethick" value="Cancelar" style="width: 150px;" 
                                         oncomplete="PF('dialogGuardarAgenda').hide()"/>
                    </h:panelGrid>
                </p:dialog>
            </p:outputPanel>
            <p:remoteCommand name="eliminarAgenda" action="#{uiAdministrarAgenda.eliminarAgenda()}"/>
            <p:remoteCommand name="aprobarAgenda" action="#{uiAdministrarAgenda.aprobarAgenda()}" update="pgBarra"/>
        </h:form>

    </ui:define>

</ui:composition>