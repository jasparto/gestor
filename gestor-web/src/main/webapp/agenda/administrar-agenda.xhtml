<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"                
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                template="/template.xhtml"
                >

    <ui:define name="content">
        <h:form enctype="multipart/form-data" style="font-size: small;">
            <p:remoteCommand name="cargarAgendaEstadoNuevo" action="#{uiAdministrarAgenda.cargarAgendaEstado()}" update="form-administrar" 
                             autoRun="true"/>
            <div align="right">
                <p:commandButton icon="ui-icon-refresh" oncomplete="cargarAgendaEstadoNuevo();" style="width: 50px; height: 50px;">
                    <f:setPropertyActionListener value="" target="#{uiAdministrarAgenda.agendaPacientesList}"/>
                </p:commandButton>
            </div>
            <br/>
        </h:form>
        <h:form  enctype="multipart/form-data" id="form-administrar" style="font-size: small;">
            <p:remoteCommand name="detalleActivo" action="#{uiAdministrarAgenda.validarConsultandoDetalle()}" autoRun="true" immediate="true"/>
            <h:panelGroup id="pg-agenda">
                <p:panel  header="Agendas Pendientes Aprobar" 
                          rendered="#{not uiAdministrarAgenda.visualizandoDetalleAgenda}">
                    <p:dataTable var="varAgendaPacientes" value="#{uiAdministrarAgenda.agendaPacientesList}" rowStyleClass="Centro"  widgetVar="widgetVarAgendaPacientes"
                                 emptyMessage="No se encuentran agendas pendientes de gestión" rows="5" paginator="true" filterEvent="enter"
                                 selectionMode="single" selection="#{uiAdministrarAgenda.agendaPacientes}" rowKey="#{varAgendaPacientes.agendaPacientesPK.codAgenda}"
                                 sortBy="#{varAgendaPacientes.agendaPacientesPK.codAgenda}" sortOrder="descending"
                                 >
                        <p:ajax event="rowDblselect" oncomplete="consultarAgendaAnalisis()" />
                        <p:column id="columnCodAgenda" headerText="Cod Agenda" filterBy="#{varAgendaPacientes.agendaPacientesPK.codAgenda}"  filterMatchMode="contains"
                                  filterable="true" sortBy="#{varAgendaPacientes.agendaPacientesPK.codAgenda}" sortable="true"> 
                            <h:outputText value="#{varAgendaPacientes.agendaPacientesPK.codAgenda}" />
                        </p:column> 

                        <p:column headerText="Usuario">
                            <h:outputText value="#{varAgendaPacientes.usuario}" />
                        </p:column>

                        <p:column headerText="Estado">
                            <h:outputText value="#{varAgendaPacientes.estado}" />
                        </p:column>

                        <p:column headerText="Fecha Creación">
                            <h:outputText value="#{varAgendaPacientes.fechaRegistro}" >
                                <f:convertDateTime pattern="dd/MM/yyyy hh:mm:ss a" timeZone="America/Bogota"/>
                            </h:outputText>
                        </p:column>
                    </p:dataTable>
                </p:panel>
            </h:panelGroup>


            <p:outputPanel>
                <p:dialog id="dialogNuevaAgenda" widgetVar="dialogNuevaAgenda" header="Nueva Agenda" showEffect="clip" hideEffect="clip"
                          closeOnEscape="true" modal="true">
                    <h:outputText value="¿ Desea iniciar con el análisis de la agenda ?"/>
                    <h:panelGrid columns="2" cellspacing="20">
                        <p:commandButton icon="ui-icon-check" value="SI" style="width: 100px;" process="@parent" action="#{uiAdministrarAgenda.generarAgendaAnalisis()}"
                                         oncomplete="PF('dialogNuevaAgenda').hide();" update="form-administrar"/>
                        <p:commandButton icon="ui-icon-closethick" value="NO" style="width: 100px;" oncomplete="PF('dialogNuevaAgenda').hide()" 
                                         process="@parent"/>
                    </h:panelGrid>
                </p:dialog>
            </p:outputPanel>

            <p:outputPanel>
                <p:dialog id="dialogConsultarAgenda" widgetVar="dialogConsultarAgenda" header="Consulta Agenda" showEffect="clip" hideEffect="clip"
                          closeOnEscape="true" modal="true">
                    <h:outputText value="¿ Desea consultar la agenda seleccionada ?"/>
                    <h:panelGrid columns="2" cellspacing="20">
                        <p:commandButton icon="ui-icon-check" value="SI" style="width: 100px;" oncomplete="PF('dialogConsultarAgenda').hide(); consultarAgendaAnalisis();"/>
                        <p:commandButton icon="ui-icon-closethick" value="NO" style="width: 100px;" oncomplete="PF('dialogConsultarAgenda').hide()"/>
                    </h:panelGrid>
                </p:dialog>
            </p:outputPanel>
            <p:remoteCommand name="consultarAgendaAnalisis" action="#{uiAdministrarAgenda.consultarAgendaAnalisis()}" delay="500"/>

            <h:panelGrid>
                <ui:include src="/barra.xhtml">
                    <ui:param name="bean" value="#{uiAdministrarAgenda}"/>
                </ui:include>
            </h:panelGrid>

            <p:dialog id="dialog" widgetVar="dialog" header="#{sesion.dialogo.header}" showEffect="#{sesion.dialogo.effect}" hideEffect="#{sesion.dialogo.effect}"
                      onHide="limpiarModal()">
                <ui:include src="#{sesion.dialogo.src}"/>
            </p:dialog>
            <p:remoteCommand name="limpiarModal" action="#{uiSesion.limpiarDialogo()}" update="dialog" />

            <p:remoteCommand name="eliminarAgenda" action="#{uiAdministrarAgenda.eliminarAgenda()}" update="pg-agenda"/>
        </h:form>

    </ui:define>

</ui:composition>
